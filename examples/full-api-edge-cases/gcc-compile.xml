<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright Â© 2006-2016 Web Cohesion (info@webcohesion.com)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->

<project name="gcccompile">

  <target name="skip-if-necessary">
    <condition property="skip.gcc">
      <istrue value="${gcc.executable}"/>
    </condition>
  </target>

  <target name="get-gnustep-flags" if="gnustep.config.executable" unless="skip.gcc">
    <exec executable="${gnustep.config.executable}" failonerror="true" errorproperty="gnustep.config.error" outputproperty="gnustep.config.flags">
      <arg value="--objc-flags"/>
    </exec>
  </target>

  <target name="get-gnustep-libs" if="gnustep.config.executable" unless="skip.gcc">
    <exec executable="${gnustep.config.executable}" failonerror="true" errorproperty="gnustep.config.error" outputproperty="gnustep.config.libs">
      <arg value="--base-libs"/>
    </exec>
  </target>

  <target name="get-libxml-flags" if="libxml.config.executable" unless="skip.gcc">
    <exec executable="${libxml.config.executable}" failonerror="true" errorproperty="libxml.config.error" outputproperty="libxml.config.flags">
      <arg value="--cflags"/>
    </exec>
  </target>

  <target name="get-libxml-libs" if="libxml.config.executable" unless="skip.gcc">
    <exec executable="${libxml.config.executable}" failonerror="true" errorproperty="libxml.config.error" outputproperty="libxml.config.libs">
      <arg value="--libs"/>
    </exec>
  </target>

  <target name="-gcc" unless="skip.gcc">
    <property name="gnustep.config.flags" value=""/>
    <property name="gnustep.config.libs" value=""/>
    <property name="libxml.config.flags" value=""/>
    <property name="libxml.config.libs" value=""/>

    <!--compile the c code.-->
    <exec executable="${gcc.executable}" failonerror="true" dir="${project.build.directory}">
      <!--include the libxml compile flags-->
      <arg line="${libxml.config.flags}"/>
      <!--include the libxml libraries-->
      <arg line="${libxml.config.libs}"/>
      <!--report all warnings...-->
      <arg value="-Wall"/>
      <!--...except the unused variable warnings-->
      <arg value="-Wno-unused-variable"/>
      <arg value="-Wno-unused-but-set-variable"/>
      <!--...and the unused function warnings-->
      <arg value="-Wno-unused-function"/>
      <!--count all warnings as errors -->
      <arg value="-Werror"/>
      <!--include the source directory-->
      <arg value="-I${project.build.directory}/enunciate/c-xml-client/src"/>
      <!--output to the file-->
      <arg line="-o ${project.build.directory}/enunciate/c-xml-client/src/c-enunciate-examples-full-api-edge-cases.o"/>
      <!--compile this file-->
      <arg line="-c ${project.build.directory}/enunciate/c-xml-client/src/enunciate-examples-full-api-edge-cases.c"/>
    </exec>

    <!--compile the objective c code.-->
    <exec executable="${gcc.executable}" failonerror="true" dir="${project.build.directory}">
      <!--include the gnustep compile flags-->
      <arg line="${gnustep.config.flags}"/>
      <!--include the libxml compile flags-->
      <arg line="${libxml.config.flags}"/>
      <!--include the gnustep libraries-->
      <arg line="${gnustep.config.libs}"/>
      <!--include the libxml libraries-->
      <arg line="${libxml.config.libs}"/>
      <!--report all warnings...-->
      <arg value="-Wall"/>
      <!--...except the unused variable warnings-->
      <arg value="-Wno-unused-variable"/>
      <arg value="-Wno-unused-but-set-variable"/>
      <!--...and the unused function warnings-->
      <arg value="-Wno-unused-function"/>
      <!--count all warnings as errors -->
      <arg value="-Werror"/>
      <!--include the source directory-->
      <arg value="-I${project.build.directory}/enunciate/obj-c-xml-client/src"/>
      <!--output to the file-->
      <arg line="-o ${project.build.directory}/enunciate/obj-c-xml-client/src/obj-c-enunciate-examples-full-api-edge-cases.o"/>
      <!--compile this file-->
      <arg line="-c ${project.build.directory}/enunciate/obj-c-xml-client/src/enunciate-examples-full-api-edge-cases.m"/>
    </exec>
  </target>

  <target name="gcc" depends="skip-if-necessary, get-gnustep-flags, get-gnustep-libs, get-libxml-flags, get-libxml-libs, -gcc"/>

</project>
